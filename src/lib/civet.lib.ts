"use strict";
// civet.lib.civet

type AutoPromise<T> = Promise<Awaited<T>>;
import {existsSync} from '@std/fs'
import {statSync} from 'node-fs'
import {Node, SourceFile} from 'npm-typescript'
import {compile as compileCivet} from '@danielx/civet'
import {RawSourceMap} from 'npm-source-map'

import {
	undef, defined, notdefined, hash, assert, isString, isHash,
	isEmpty, nonEmpty, croak,
	} from 'datatypes'
import {getOptions, o, getErrStr} from 'llutils'
import {OL, ML} from 'to-nice'
import {LOG, DBG, DBGVALUE} from 'logger'
import {flag, debugging, inspecting} from 'cmd-args'
import {
	isFile, fileExt, withExt, slurp, slurpAsync, pathStr,
	barf, barfTempFile, parsePath, addJsonValue, normalizePath,
	} from 'fsys'
import {
	TExecResult, execCmdSync, execCmd, CFileHandler,
	} from 'exec'
import {ts2ast, analyze, typeCheckTsCode} from 'typescript'
import {extractSourceMap, haveSourceMapFor} from 'source-map'

import hCivetConfig from "civetconfig" with {type: "json"};

// ---------------------------------------------------------------------------

export type TCivetOptions = {
	force?: boolean
	inlineMap?: boolean
	}

// ---------------------------------------------------------------------------
// --- Due to a bug in either the v8 engine or Deno,
//     we have to generate, then remove the inline source map,
//     saving it to use in mapping source lines later

class CCivetCompiler extends CFileHandler {

	get op() {
		return 'doCompileCivet'
	}

	override async handle(
			path: string,
			hOptions: hash = {}
			): AutoPromise<TExecResult> {

		const {force, inlineMap} = getOptions<TCivetOptions>(hOptions, {
			force: false,
			inlineMap: true
			})

		assert((fileExt(path) === '.civet'), `Not a civet file: ${path}`)
		const destPath = withExt(path, '.ts')

		// --- Check if a newer compiled version already exists
		if (
				   !force
				&& existsSync(destPath)
				&& (statSync(destPath).mtimeMs > statSync(path).mtimeMs)
				&& haveSourceMapFor(path)
				) {
			return {success: true, notNeeded: true}
		}

		try {
			const civetCode = await slurpAsync(path)
			const tsCode: string = await compileCivet(civetCode, {
				...hCivetConfig,
				inlineMap,
				filename: path
				})
			if (!tsCode || tsCode.startsWith('COMPILE FAILED')) {
				const errMsg = `CIVET COMPILE FAILED: ${pathStr(path)}`
				return {
					success: false,
					stderr: errMsg,
					output: errMsg
					}
			}
			const tempPath = barfTempFile(tsCode, {ext: '.ts'})
			const hResult = await execCmd('deno', ['check', tempPath])
			assert(hResult.success, "Type check failed")
			const [code, hSrcMap] = extractSourceMap(tsCode)
			if (defined(hSrcMap)) {
				addJsonValue('sourcemap.jsonc', normalizePath(destPath), hSrcMap)
			}
			await Deno.writeTextFile(destPath, code)
			return {success: true}
		}
		catch (err) {
			if (debugging) {
				LOG(getErrStr(err))
			}
			const errMsg = `COMPILE FAILED: ${pathStr(path)} - ${getErrStr(err)}`
			return {
				success: false,
				stderr: errMsg,
				output: errMsg,
			}
		}
	}
}

export const doCompileCivet = new CCivetCompiler()

// ---------------------------------------------------------------------------
// SYNC

export const civet2tsFile = (
		path: string,
		tsPath: string = withExt(path, '.ts'),
		hOptions: hash = {}
		): string => {

	const {force, inlineMap} = getOptions<TCivetOptions>(hOptions, {
		force: false,
		inlineMap: true
		})

	assert((fileExt(path) === '.civet'), `Not a civet file: ${path}`)

	// --- Check if a newer compiled version already exists
	if (
				!force
			&& existsSync(tsPath)
			&& (statSync(tsPath).mtimeMs > statSync(path).mtimeMs)
			&& haveSourceMapFor(path)
			) {
		return tsPath
	}

	const civetCode = slurp(path)
	const tsCode = civet2ts(civetCode, hOptions, path)
	const [code, hSrcMap] = extractSourceMap(tsCode)
	if (defined(hSrcMap)) {
		addJsonValue('sourcemap.jsonc', normalizePath(tsPath), hSrcMap)
	}
	Deno.writeTextFileSync(tsPath, code)
	return tsPath
}

// ---------------------------------------------------------------------------

export const civet2ts = (
		civetCode: string,
		hOptions: hash = {},
		path: (string | undefined) = undef
		): string => {

	const {inlineMap} = getOptions<TCivetOptions>(hOptions, {
		inlineMap: true
		})
	if (inlineMap && notdefined(path)) {
		croak("path is required with inlineMap")
	}

	const tsCode: string = compileCivet(civetCode, {
		...hCivetConfig,
		sync: true,
		inlineMap,
		filename: path
		})
	if (!tsCode || tsCode.startsWith('COMPILE FAILED')) {
		if (defined(path)) {
			croak(`CIVET COMPILE FAILED: ${pathStr(path)}`)
		}
		else {
			croak("CIVET COMPILE FAILED")
		}
	}
	const errMsg = typeCheckTsCode(tsCode)
	if (errMsg) {
		croak(errMsg)
	}
	return tsCode
}

// ---------------------------------------------------------------------------

export const civet2ast = (civetCode: string): Node => {

	const tsCode = civet2ts(civetCode)
	return ts2ast(tsCode)
}

// ---------------------------------------------------------------------------

// --- template literals to simplify displaying
//     the analysis of civet code

export const a = (lStrings: TemplateStringsArray): string => {
	return analyze(civet2ts(lStrings[0])).asString()
}

export const A = (lStrings: TemplateStringsArray): string => {
	return analyze(civet2ts(lStrings[0]), o`dump`).asString()
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3JjL2xpYi9jaXZldC5saWIuY2l2ZXQudHN4Iiwic291cmNlcyI6WyJzcmMvbGliL2NpdmV0LmxpYi5jaXZldCJdLCJtYXBwaW5ncyI6IjtBQUFBLGtCQUFpQjtBQUNqQixBQUFBO0FBQ0EsSyxXLHlCO0FBQUEsTUFBTSxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVM7QUFDbEMsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTO0FBQ2hDLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCO0FBQy9DLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUEsR0FBRSxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCO0FBQ3BELEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCO0FBQzNDLEFBQUE7QUFDQSxBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLEtBQUssQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLE1BQU0sQ0FBQztBQUM1RCxDQUFDLE9BQU8sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEtBQUssQ0FBQztBQUMxQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVztBQUNuQixBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVM7QUFDaEQsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTO0FBQzlCLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FB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Q0EsQUFBQSw4RUFBNkU7QUFDN0UsQUFBQTtBQUNBLEFBQUEsQUFBQSxNQUFNLENBQVUsTUFBVCxTQUFTLENBQUMsQ0FBRSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFBLENBQUE7QUFDaEQsQUFBQTtBQUNBLEFBQUEsQ0FBTyxNQUFOLE1BQU0sQ0FBQyxDQUFFLENBQUMsUUFBUSxDQUFBLEFBQUMsU0FBUyxDQUFBO0FBQzdCLEFBQUEsQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFBLEFBQUMsTUFBTSxDO0FBQUEsQ0FBQTtBQUNyQixBQUFBO0FBQ0EsQUFBQSw4RUFBNkU7QUFDN0UsQUFBQTtBQUNBLEFBQUEsK0NBQThDO0FBQzlDLEFBQUEsaUNBQWdDO0FBQ2hDLEFBQUE7QUFDQSxBQUFBLEFBQUEsTUFBTSxDQUFFLE1BQUQsQ0FBQyxDQUFDLENBQUUsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLG9CQUFvQixDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFBLENBQUE7QUFDdkQsQUFBQSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsUUFBUSxDQUFBLEFBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFBLENBQUMsQ0FBQyxRQUFRLENBQUMsQztBQUFDLENBQUE7QUFDaEQsQUFBQTtBQUNBLEFBQUEsQUFBQSxNQUFNLENBQUUsTUFBRCxDQUFDLENBQUMsQ0FBRSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUEsQ0FBQTtBQUN2RCxBQUFBLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDLE1BQU8sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDO0FBQ3pEIiwibmFtZXMiOltdLCJzb3VyY2VzQ29udGVudCI6WyIjIGNpdmV0LmxpYi5jaXZldFxuXG5pbXBvcnQge2V4aXN0c1N5bmN9IGZyb20gJ0BzdGQvZnMnXG5pbXBvcnQge3N0YXRTeW5jfSBmcm9tICdub2RlLWZzJ1xuaW1wb3J0IHtOb2RlLCBTb3VyY2VGaWxlfSBmcm9tICducG0tdHlwZXNjcmlwdCdcbmltcG9ydCB7Y29tcGlsZTogY29tcGlsZUNpdmV0fSBmcm9tICdAZGFuaWVseC9jaXZldCdcbmltcG9ydCB7UmF3U291cmNlTWFwfSBmcm9tICducG0tc291cmNlLW1hcCdcblxuaW1wb3J0IHtcblx0dW5kZWYsIGRlZmluZWQsIG5vdGRlZmluZWQsIGhhc2gsIGFzc2VydCwgaXNTdHJpbmcsIGlzSGFzaCxcblx0aXNFbXB0eSwgbm9uRW1wdHksIGNyb2FrLFxuXHR9IGZyb20gJ2RhdGF0eXBlcydcbmltcG9ydCB7Z2V0T3B0aW9ucywgbywgZ2V0RXJyU3RyfSBmcm9tICdsbHV0aWxzJ1xuaW1wb3J0IHtPTCwgTUx9IGZyb20gJ3RvLW5pY2UnXG5pbXBvcnQge0xPRywgREJHLCBEQkdWQUxVRX0gZnJvbSAnbG9nZ2VyJ1xuaW1wb3J0IHtmbGFnLCBkZWJ1Z2dpbmcsIGluc3BlY3Rpbmd9IGZyb20gJ2NtZC1hcmdzJ1xuaW1wb3J0IHtcblx0aXNGaWxlLCBmaWxlRXh0LCB3aXRoRXh0LCBzbHVycCwgc2x1cnBBc3luYywgcGF0aFN0cixcblx0YmFyZiwgYmFyZlRlbXBGaWxlLCBwYXJzZVBhdGgsIGFkZEpzb25WYWx1ZSwgbm9ybWFsaXplUGF0aCxcblx0fSBmcm9tICdmc3lzJ1xuaW1wb3J0IHtcblx0VEV4ZWNSZXN1bHQsIGV4ZWNDbWRTeW5jLCBleGVjQ21kLCBDRmlsZUhhbmRsZXIsXG5cdH0gZnJvbSAnZXhlYydcbmltcG9ydCB7dHMyYXN0LCBhbmFseXplLCB0eXBlQ2hlY2tUc0NvZGV9IGZyb20gJ3R5cGVzY3JpcHQnXG5pbXBvcnQge2V4dHJhY3RTb3VyY2VNYXAsIGhhdmVTb3VyY2VNYXBGb3J9IGZyb20gJ3NvdXJjZS1tYXAnXG5cbmltcG9ydCBoQ2l2ZXRDb25maWcgZnJvbSBcImNpdmV0Y29uZmlnXCIgd2l0aCB7dHlwZTogXCJqc29uXCJ9O1xuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5leHBvcnQgdHlwZSBUQ2l2ZXRPcHRpb25zID0ge1xuXHRmb3JjZT86IGJvb2xlYW5cblx0aW5saW5lTWFwPzogYm9vbGVhblxuXHR9XG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4jIC0tLSBEdWUgdG8gYSBidWcgaW4gZWl0aGVyIHRoZSB2OCBlbmdpbmUgb3IgRGVubyxcbiMgICAgIHdlIGhhdmUgdG8gZ2VuZXJhdGUsIHRoZW4gcmVtb3ZlIHRoZSBpbmxpbmUgc291cmNlIG1hcCxcbiMgICAgIHNhdmluZyBpdCB0byB1c2UgaW4gbWFwcGluZyBzb3VyY2UgbGluZXMgbGF0ZXJcblxuY2xhc3MgQ0NpdmV0Q29tcGlsZXIgZXh0ZW5kcyBDRmlsZUhhbmRsZXJcblxuXHRnZXQgb3AoKVxuXHRcdHJldHVybiAnZG9Db21waWxlQ2l2ZXQnXG5cblx0b3ZlcnJpZGUgaGFuZGxlKFxuXHRcdFx0cGF0aDogc3RyaW5nLFxuXHRcdFx0aE9wdGlvbnM6IGhhc2ggPSB7fVxuXHRcdFx0KTogVEV4ZWNSZXN1bHRcblxuXHRcdHtmb3JjZSwgaW5saW5lTWFwfSA6PSBnZXRPcHRpb25zPFRDaXZldE9wdGlvbnM+IGhPcHRpb25zLCB7XG5cdFx0XHRmb3JjZTogZmFsc2Vcblx0XHRcdGlubGluZU1hcDogdHJ1ZVxuXHRcdFx0fVxuXG5cdFx0YXNzZXJ0IChmaWxlRXh0KHBhdGgpID09ICcuY2l2ZXQnKSwgXCJOb3QgYSBjaXZldCBmaWxlOiAje3BhdGh9XCJcblx0XHRkZXN0UGF0aCA6PSB3aXRoRXh0IHBhdGgsICcudHMnXG5cblx0XHQjIC0tLSBDaGVjayBpZiBhIG5ld2VyIGNvbXBpbGVkIHZlcnNpb24gYWxyZWFkeSBleGlzdHNcblx0XHRpZiAoXG5cdFx0XHRcdCAgIG5vdCBmb3JjZVxuXHRcdFx0XHQmJiBleGlzdHNTeW5jKGRlc3RQYXRoKVxuXHRcdFx0XHQmJiAoc3RhdFN5bmMoZGVzdFBhdGgpLm10aW1lTXMgPiBzdGF0U3luYyhwYXRoKS5tdGltZU1zKVxuXHRcdFx0XHQmJiBoYXZlU291cmNlTWFwRm9yKHBhdGgpXG5cdFx0XHRcdClcblx0XHRcdHJldHVybiB7c3VjY2VzczogdHJ1ZSwgbm90TmVlZGVkOiB0cnVlfVxuXG5cdFx0dHJ5XG5cdFx0XHRjaXZldENvZGUgOj0gYXdhaXQgc2x1cnBBc3luYyBwYXRoXG5cdFx0XHR0c0NvZGU6IHN0cmluZyA6PSBhd2FpdCBjb21waWxlQ2l2ZXQgY2l2ZXRDb2RlLCB7XG5cdFx0XHRcdC4uLmhDaXZldENvbmZpZ1xuXHRcdFx0XHRpbmxpbmVNYXBcblx0XHRcdFx0ZmlsZW5hbWU6IHBhdGhcblx0XHRcdFx0fVxuXHRcdFx0aWYgbm90IHRzQ29kZSB8fCB0c0NvZGUuc3RhcnRzV2l0aCgnQ09NUElMRSBGQUlMRUQnKVxuXHRcdFx0XHRlcnJNc2cgOj0gXCJDSVZFVCBDT01QSUxFIEZBSUxFRDogI3twYXRoU3RyKHBhdGgpfVwiXG5cdFx0XHRcdHJldHVybiB7XG5cdFx0XHRcdFx0c3VjY2VzczogZmFsc2Vcblx0XHRcdFx0XHRzdGRlcnI6IGVyck1zZ1xuXHRcdFx0XHRcdG91dHB1dDogZXJyTXNnXG5cdFx0XHRcdFx0fVxuXHRcdFx0dGVtcFBhdGggOj0gYmFyZlRlbXBGaWxlIHRzQ29kZSwge2V4dDogJy50cyd9XG5cdFx0XHRoUmVzdWx0IDo9IGF3YWl0IGV4ZWNDbWQgJ2Rlbm8nLCBbJ2NoZWNrJywgdGVtcFBhdGhdXG5cdFx0XHRhc3NlcnQgaFJlc3VsdC5zdWNjZXNzLCBcIlR5cGUgY2hlY2sgZmFpbGVkXCJcblx0XHRcdFtjb2RlLCBoU3JjTWFwXSA6PSBleHRyYWN0U291cmNlTWFwKHRzQ29kZSlcblx0XHRcdGlmIGRlZmluZWQoaFNyY01hcClcblx0XHRcdFx0YWRkSnNvblZhbHVlICdzb3VyY2VtYXAuanNvbmMnLCBub3JtYWxpemVQYXRoKGRlc3RQYXRoKSwgaFNyY01hcFxuXHRcdFx0YXdhaXQgRGVuby53cml0ZVRleHRGaWxlIGRlc3RQYXRoLCBjb2RlXG5cdFx0XHRyZXR1cm4ge3N1Y2Nlc3M6IHRydWV9XG5cdFx0Y2F0Y2ggZXJyXG5cdFx0XHRpZiBkZWJ1Z2dpbmdcblx0XHRcdFx0TE9HIGdldEVyclN0cihlcnIpXG5cdFx0XHRlcnJNc2cgOj0gXCJDT01QSUxFIEZBSUxFRDogI3twYXRoU3RyKHBhdGgpfSAtICN7Z2V0RXJyU3RyKGVycil9XCJcblx0XHRcdHJldHVyblxuXHRcdFx0XHRzdWNjZXNzOiBmYWxzZVxuXHRcdFx0XHRzdGRlcnI6IGVyck1zZ1xuXHRcdFx0XHRvdXRwdXQ6IGVyck1zZ1xuXG5leHBvcnQgZG9Db21waWxlQ2l2ZXQgOj0gbmV3IENDaXZldENvbXBpbGVyKClcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiMgU1lOQ1xuXG5leHBvcnQgY2l2ZXQydHNGaWxlIDo9IChcblx0XHRwYXRoOiBzdHJpbmcsXG5cdFx0dHNQYXRoOiBzdHJpbmcgPSB3aXRoRXh0KHBhdGgsICcudHMnKSxcblx0XHRoT3B0aW9uczogaGFzaCA9IHt9XG5cdFx0KTogc3RyaW5nID0+XG5cblx0e2ZvcmNlLCBpbmxpbmVNYXB9IDo9IGdldE9wdGlvbnM8VENpdmV0T3B0aW9ucz4gaE9wdGlvbnMsIHtcblx0XHRmb3JjZTogZmFsc2Vcblx0XHRpbmxpbmVNYXA6IHRydWVcblx0XHR9XG5cblx0YXNzZXJ0IChmaWxlRXh0KHBhdGgpID09ICcuY2l2ZXQnKSwgXCJOb3QgYSBjaXZldCBmaWxlOiAje3BhdGh9XCJcblxuXHQjIC0tLSBDaGVjayBpZiBhIG5ld2VyIGNvbXBpbGVkIHZlcnNpb24gYWxyZWFkeSBleGlzdHNcblx0aWYgKFxuXHRcdFx0XHRub3QgZm9yY2Vcblx0XHRcdCYmIGV4aXN0c1N5bmModHNQYXRoKVxuXHRcdFx0JiYgKHN0YXRTeW5jKHRzUGF0aCkubXRpbWVNcyA+IHN0YXRTeW5jKHBhdGgpLm10aW1lTXMpXG5cdFx0XHQmJiBoYXZlU291cmNlTWFwRm9yKHBhdGgpXG5cdFx0XHQpXG5cdFx0cmV0dXJuIHRzUGF0aFxuXG5cdGNpdmV0Q29kZSA6PSBzbHVycCBwYXRoXG5cdHRzQ29kZSA6PSBjaXZldDJ0cyBjaXZldENvZGUsIGhPcHRpb25zLCBwYXRoXG5cdFtjb2RlLCBoU3JjTWFwXSA6PSBleHRyYWN0U291cmNlTWFwKHRzQ29kZSlcblx0aWYgZGVmaW5lZChoU3JjTWFwKVxuXHRcdGFkZEpzb25WYWx1ZSAnc291cmNlbWFwLmpzb25jJywgbm9ybWFsaXplUGF0aCh0c1BhdGgpLCBoU3JjTWFwXG5cdERlbm8ud3JpdGVUZXh0RmlsZVN5bmMgdHNQYXRoLCBjb2RlXG5cdHJldHVybiB0c1BhdGhcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZXhwb3J0IGNpdmV0MnRzIDo9IChcblx0XHRjaXZldENvZGU6IHN0cmluZyxcblx0XHRoT3B0aW9uczogaGFzaCA9IHt9XG5cdFx0cGF0aDogc3RyaW5nPyA9IHVuZGVmXG5cdFx0KTogc3RyaW5nID0+XG5cblx0e2lubGluZU1hcH0gOj0gZ2V0T3B0aW9uczxUQ2l2ZXRPcHRpb25zPiBoT3B0aW9ucywge1xuXHRcdGlubGluZU1hcDogdHJ1ZVxuXHRcdH1cblx0aWYgaW5saW5lTWFwICYmIG5vdGRlZmluZWQocGF0aClcblx0XHRjcm9hayBcInBhdGggaXMgcmVxdWlyZWQgd2l0aCBpbmxpbmVNYXBcIlxuXG5cdHRzQ29kZTogc3RyaW5nIDo9IGNvbXBpbGVDaXZldCBjaXZldENvZGUsIHtcblx0XHQuLi5oQ2l2ZXRDb25maWdcblx0XHRzeW5jOiB0cnVlXG5cdFx0aW5saW5lTWFwXG5cdFx0ZmlsZW5hbWU6IHBhdGhcblx0XHR9XG5cdGlmIG5vdCB0c0NvZGUgfHwgdHNDb2RlLnN0YXJ0c1dpdGgoJ0NPTVBJTEUgRkFJTEVEJylcblx0XHRpZiBkZWZpbmVkKHBhdGgpXG5cdFx0XHRjcm9hayBcIkNJVkVUIENPTVBJTEUgRkFJTEVEOiAje3BhdGhTdHIocGF0aCl9XCJcblx0XHRlbHNlXG5cdFx0XHRjcm9hayBcIkNJVkVUIENPTVBJTEUgRkFJTEVEXCJcblx0ZXJyTXNnIDo9IHR5cGVDaGVja1RzQ29kZSB0c0NvZGVcblx0aWYgZXJyTXNnXG5cdFx0Y3JvYWsgZXJyTXNnXG5cdHJldHVybiB0c0NvZGVcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZXhwb3J0IGNpdmV0MmFzdCA6PSAoY2l2ZXRDb2RlOiBzdHJpbmcpOiBOb2RlID0+XG5cblx0dHNDb2RlIDo9IGNpdmV0MnRzIGNpdmV0Q29kZVxuXHRyZXR1cm4gdHMyYXN0IHRzQ29kZVxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4jIC0tLSB0ZW1wbGF0ZSBsaXRlcmFscyB0byBzaW1wbGlmeSBkaXNwbGF5aW5nXG4jICAgICB0aGUgYW5hbHlzaXMgb2YgY2l2ZXQgY29kZVxuXG5leHBvcnQgYSA6PSAobFN0cmluZ3M6IFRlbXBsYXRlU3RyaW5nc0FycmF5KTogc3RyaW5nID0+XG5cdHJldHVybiBhbmFseXplKGNpdmV0MnRzIGxTdHJpbmdzWzBdKS5hc1N0cmluZygpXG5cbmV4cG9ydCBBIDo9IChsU3RyaW5nczogVGVtcGxhdGVTdHJpbmdzQXJyYXkpOiBzdHJpbmcgPT5cblx0cmV0dXJuIGFuYWx5emUoY2l2ZXQydHMobFN0cmluZ3NbMF0pLCBvJ2R1bXAnKS5hc1N0cmluZygpIl19