"use strict";
// ---  buildcmd.cmd.civet

import {stdChecks} from 'llutils'
import {assert, defined} from 'datatypes'
import {nonOption, allNonOptions, flag} from 'cmd-args'
import {withExt, findFile, isFile} from 'fsys'
import {
	procFiles, procOneFile, doCompileCivet,
	doUnitTest, doInstallCmd,
	} from 'exec'

stdChecks("buildcmd -n (all | <stub>*)")
const noInstall = flag('n')
if (noInstall) {
	console.log(`noInstall = ${noInstall}`)
}

// ---------------------------------------------------------------------------

if (nonOption(0) === 'all') {
	await procFiles(['*.cmd.civet',      doCompileCivet])
	await procFiles(['*.cmd.test.civet', doCompileCivet])
	await procFiles(['*.cmd.test.ts',    doUnitTest])
	if (!noInstall) {
		await procFiles(['*.cmd.ts',         doInstallCmd])
	}
}
else {
	for (const stub of allNonOptions()) {
		const fileName = `${stub}.cmd.civet`
		const path = findFile(fileName)
		assert(defined(path), `No such cmd file: ${fileName}`)
		await procOneFile(path, doCompileCivet)
		const tsPath = withExt(path, '.ts')
		assert(isFile(tsPath), `File ${tsPath} not created`)

		const testPath = withExt(path, '.test.civet')
		if (findFile(testPath)) {
			await procOneFile(testPath, doCompileCivet)
			await procOneFile(withExt(path, '.test.ts'), doUnitTest)
		}
		else {
			console.log(`No unit test named ${testPath}`)
		}
		if (!noInstall) {
			await procOneFile(tsPath, doInstallCmd)
		}
	}
}


//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3JjL2NtZC9idWlsZGNtZC5jbWQuY2l2ZXQudHN4Iiwic291cmNlcyI6WyJzcmMvY21kL2J1aWxkY21kLmNtZC5jaXZldCJdLCJtYXBwaW5ncyI6IjtBQUFBLDBCQUF5QjtBQUN6QixBQUFBO0FBQ0EsQUFBQSxNQUFNLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUztBQUNqQyxBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsSUFBSSxDQUFDLFdBQVc7QUFDekMsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxVQUFVO0FBQ3ZELEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTTtBQUM5QyxBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUM7QUFDUixDQUFDLFNBQVMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLGNBQWMsQ0FBQztBQUN4QyxDQUFDLFVBQVUsQ0FBQyxDQUFDLFlBQVksQ0FBQztBQUMxQixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTTtBQUNkLEFBQUE7QUFDQSxBQUFBLEFBQUEsU0FBUyxDQUFBLEFBQUMsNkJBQTZCLENBQUE7QUFDdkMsQUFBQSxBQUFTLE1BQVQsU0FBUyxDQUFDLENBQUUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDO0FBQ3RCLEFBQUEsQUFBQSxHQUFHLENBQUEsU0FBUyxDQUFBLENBQUEsQ0FBQTtBQUNaLEFBQUEsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFBLEFBQUMsQ0FBQyxZQUFZLEVBQUUsU0FBUyxDQUFDLENBQUMsQztBQUFBLENBQUE7QUFDdkMsQUFBQTtBQUNBLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUE7QUFDQSxBQUFBLEFBQUEsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxHQUFFLENBQUMsS0FBSyxDQUFDLENBQUEsQ0FBQTtBQUMxQixBQUFBLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQSxBQUFDLENBQUMsYUFBYSxDQUFDLE1BQU0sY0FBYyxDQUFDLENBQUE7QUFDckQsQUFBQSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUEsQUFBQyxDQUFDLGtCQUFrQixDQUFDLENBQUMsY0FBYyxDQUFDLENBQUE7QUFDckQsQUFBQSxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUEsQUFBQyxDQUFDLGVBQWUsQ0FBQyxJQUFJLFVBQVUsQ0FBQyxDQUFBO0FBQ2pELEFBQUEsQ0FBQyxHQUFHLENBQUEsQ0FBSSxTQUFTLENBQUEsQ0FBQSxDQUFBO0FBQ2pCLEFBQUEsRUFBRSxLQUFLLENBQUMsU0FBUyxDQUFBLEFBQUMsQ0FBQyxVQUFVLENBQUMsU0FBUyxZQUFZLENBQUMsQztDQUFBLEM7QUFBQSxDQUFBO0FBQ3BELEFBQUEsQUFBQSxJQUFJLENBQUEsQ0FBQTtBQUNKLEFBQUEsQ0FBQyxHQUFHLENBQUMsQ0FBQSxNQUFBLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQSxDQUFBLENBQUE7QUFDNUIsQUFBQSxFQUFVLE1BQVIsUUFBUSxDQUFDLENBQUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLFVBQVUsQ0FBQztBQUNqQyxBQUFBLEVBQU0sTUFBSixJQUFJLENBQUMsQ0FBRSxDQUFDLFFBQVEsQ0FBQSxBQUFDLFFBQVEsQ0FBQTtBQUMzQixBQUFBLEVBQUUsTUFBTSxDQUFBLEFBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxrQkFBa0IsRUFBRSxRQUFRLENBQUMsQ0FBQyxDQUFBO0FBQ3ZELEFBQUEsRUFBRSxLQUFLLENBQUMsV0FBVyxDQUFBLEFBQUMsSUFBSSxDQUFDLENBQUMsY0FBYyxDQUFBO0FBQ3hDLEFBQUEsRUFBUSxNQUFOLE1BQU0sQ0FBQyxDQUFFLENBQUMsT0FBTyxDQUFBLEFBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFBO0FBQy9CLEFBQUEsRUFBRSxNQUFNLENBQUEsQUFBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsWUFBWSxDQUFDLENBQUE7QUFDckQsQUFBQTtBQUNBLEFBQUEsRUFBVSxNQUFSLFFBQVEsQ0FBQyxDQUFFLENBQUMsT0FBTyxDQUFBLEFBQUMsSUFBSSxDQUFDLENBQUMsYUFBYSxDQUFBO0FBQ3pDLEFBQUEsRUFBRSxHQUFHLENBQUEsUUFBUSxDQUFBLEFBQUMsUUFBUSxDQUFBLENBQUEsQ0FBQSxDQUFBO0FBQ3RCLEFBQUEsR0FBRyxLQUFLLENBQUMsV0FBVyxDQUFBLEFBQUMsUUFBUSxDQUFDLENBQUMsY0FBYyxDQUFBO0FBQzdDLEFBQUEsR0FBRyxLQUFLLENBQUMsV0FBVyxDQUFBLEFBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsVUFBVSxDO0VBQUEsQ0FBQTtBQUMxRCxBQUFBLEVBQUUsSUFBSSxDQUFBLENBQUE7QUFDTixBQUFBLEdBQUcsT0FBTyxDQUFDLEdBQUcsQ0FBQSxBQUFDLENBQUMsbUJBQW1CLEVBQUUsUUFBUSxDQUFDLENBQUMsQztFQUFBLENBQUE7QUFDL0MsQUFBQSxFQUFFLEdBQUcsQ0FBQSxDQUFJLFNBQVMsQ0FBQSxDQUFBLENBQUE7QUFDbEIsQUFBQSxHQUFHLEtBQUssQ0FBQyxXQUFXLENBQUEsQUFBQyxNQUFNLENBQUMsQ0FBQyxZQUFZLEM7RUFBQSxDO0NBQUEsQztBQUFBLENBQUE7QUFDekM7QUFDQSIsIm5hbWVzIjpbXSwic291cmNlc0NvbnRlbnQiOlsiIyAtLS0gIGJ1aWxkY21kLmNtZC5jaXZldFxuXG5pbXBvcnQge3N0ZENoZWNrc30gZnJvbSAnbGx1dGlscydcbmltcG9ydCB7YXNzZXJ0LCBkZWZpbmVkfSBmcm9tICdkYXRhdHlwZXMnXG5pbXBvcnQge25vbk9wdGlvbiwgYWxsTm9uT3B0aW9ucywgZmxhZ30gZnJvbSAnY21kLWFyZ3MnXG5pbXBvcnQge3dpdGhFeHQsIGZpbmRGaWxlLCBpc0ZpbGV9IGZyb20gJ2ZzeXMnXG5pbXBvcnQge1xuXHRwcm9jRmlsZXMsIHByb2NPbmVGaWxlLCBkb0NvbXBpbGVDaXZldCxcblx0ZG9Vbml0VGVzdCwgZG9JbnN0YWxsQ21kLFxuXHR9IGZyb20gJ2V4ZWMnXG5cbnN0ZENoZWNrcyBcImJ1aWxkY21kIC1uIChhbGwgfCA8c3R1Yj4qKVwiXG5ub0luc3RhbGwgOj0gZmxhZygnbicpXG5pZiBub0luc3RhbGxcblx0Y29uc29sZS5sb2cgXCJub0luc3RhbGwgPSAje25vSW5zdGFsbH1cIlxuXG4jIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5pZiAobm9uT3B0aW9uKDApID09ICdhbGwnKVxuXHRhd2FpdCBwcm9jRmlsZXMgWycqLmNtZC5jaXZldCcsICAgICAgZG9Db21waWxlQ2l2ZXRdXG5cdGF3YWl0IHByb2NGaWxlcyBbJyouY21kLnRlc3QuY2l2ZXQnLCBkb0NvbXBpbGVDaXZldF1cblx0YXdhaXQgcHJvY0ZpbGVzIFsnKi5jbWQudGVzdC50cycsICAgIGRvVW5pdFRlc3RdXG5cdGlmIG5vdCBub0luc3RhbGxcblx0XHRhd2FpdCBwcm9jRmlsZXMgWycqLmNtZC50cycsICAgICAgICAgZG9JbnN0YWxsQ21kXVxuZWxzZVxuXHRmb3Igc3R1YiBvZiBhbGxOb25PcHRpb25zKClcblx0XHRmaWxlTmFtZSA6PSBcIiN7c3R1Yn0uY21kLmNpdmV0XCJcblx0XHRwYXRoIDo9IGZpbmRGaWxlIGZpbGVOYW1lXG5cdFx0YXNzZXJ0IGRlZmluZWQocGF0aCksIFwiTm8gc3VjaCBjbWQgZmlsZTogI3tmaWxlTmFtZX1cIlxuXHRcdGF3YWl0IHByb2NPbmVGaWxlIHBhdGgsIGRvQ29tcGlsZUNpdmV0XG5cdFx0dHNQYXRoIDo9IHdpdGhFeHQgcGF0aCwgJy50cydcblx0XHRhc3NlcnQgaXNGaWxlKHRzUGF0aCksIFwiRmlsZSAje3RzUGF0aH0gbm90IGNyZWF0ZWRcIlxuXG5cdFx0dGVzdFBhdGggOj0gd2l0aEV4dCBwYXRoLCAnLnRlc3QuY2l2ZXQnXG5cdFx0aWYgZmluZEZpbGUgdGVzdFBhdGhcblx0XHRcdGF3YWl0IHByb2NPbmVGaWxlIHRlc3RQYXRoLCBkb0NvbXBpbGVDaXZldFxuXHRcdFx0YXdhaXQgcHJvY09uZUZpbGUgd2l0aEV4dChwYXRoLCAnLnRlc3QudHMnKSwgZG9Vbml0VGVzdFxuXHRcdGVsc2Vcblx0XHRcdGNvbnNvbGUubG9nIFwiTm8gdW5pdCB0ZXN0IG5hbWVkICN7dGVzdFBhdGh9XCJcblx0XHRpZiBub3Qgbm9JbnN0YWxsXG5cdFx0XHRhd2FpdCBwcm9jT25lRmlsZSB0c1BhdGgsIGRvSW5zdGFsbENtZFxuXG4iXX0=