"use strict";
// --- debugtemp.cmd.civet

import {writeln} from 'console-utils'
import {undef, defined, assert, croak} from 'datatypes'
import {findFile, parsePath, withExt, isFile} from 'fsys'
import {DUMP} from 'to-nice'
import {
	procOneFile, procFiles, doDebug, doCompileCivet, getErrStr,
	} from 'exec'
import {splitArray, sep, stdChecks} from 'llutils'
import {flag, argValue, allNonOptions} from 'cmd-args'
import {LOG, DBG} from 'logger'

stdChecks(`runtemp [-d] [-name=<temp_stub> { <lib_stub> }
	- if lib  <lib_stub>.lib.civet   exists, compile it
	- if file <temp_stub>.temp.civet  exists, compile and run it
	- default <temp_stub>, if none provided, is 'temp'`)

// ---------------------------------------------------------------------------
// --- Compile any libraries

for (const libStub of allNonOptions()) {
	const libPath = findFile(`${libStub}.lib.civet`)
	if (defined(libPath)) {
		await procOneFile(libPath, doCompileCivet)
	}
	else {
		LOG(`No such file: ${libStub}.lib.civet`)
	}
}

// --- Compile temp file
const stub = argValue('name') || 'temp'
const path = findFile(`${stub}.civet`, {root: './src/temp'})
if (defined(path)) {
	await procOneFile(path, doCompileCivet)
}
else {
	LOG(`No such file: ${stub}.civet}`)
	Deno.exit(99)
}

// --- Run the temp file
debugger
try {
	const tsPath = withExt(path, '.ts')
	assert(isFile(tsPath), `No such file: ${tsPath}`)
	const h = await procOneFile(tsPath, doDebug)
	if (defined(h.output)) {
		DUMP(h.output, 'OUTPUT')
	}
	else {
		LOG("No output!")
	}
}
catch (err) {
	console.log("TEMP FILE ERRORS:")
	console.log(getErrStr(err))
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzovVXNlcnMvam9obmQvdXRpbHMvc3JjL2NtZC9kZWJ1Z3RlbXAuY21kLmNpdmV0LnRzeCIsInNvdXJjZXMiOlsiQzovVXNlcnMvam9obmQvdXRpbHMvc3JjL2NtZC9kZWJ1Z3RlbXAuY21kLmNpdmV0Il0sIm1hcHBpbmdzIjoiO0FBQUEsMEJBQXlCO0FBQ3pCLEFBQUE7QUFDQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxlQUFlO0FBQ3JDLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVztBQUN2RCxBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU07QUFDekQsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTO0FBQzVCLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsV0FBVyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUMsU0FBUyxDQUFDO0FBQzVELENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNO0FBQ2QsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLFVBQVUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTO0FBQ2xELEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQyxJQUFJLENBQUMsVUFBVTtBQUN0RCxBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVE7QUFDL0IsQUFBQTtBQUNBLEFBQUEsQUFBQSxTQUFTLENBQUEsQUFBQyxDQUFHO0FBQ2I7QUFDQTtBQUNBLG1EQUVJLENBQUcsQ0FBQTtBQUNQLEFBQUE7QUFDQSxBQUFBLDhFQUE2RTtBQUM3RSxBQUFBLDRCQUEyQjtBQUMzQixBQUFBO0FBQ0EsQUFBQSxBQUFBLEdBQUcsQ0FBQyxDQUFBLE1BQUEsT0FBTyxDQUFDLEVBQUUsQ0FBQyxhQUFhLENBQUMsQ0FBQyxDQUFBLENBQUEsQ0FBQTtBQUM5QixBQUFBLENBQVEsTUFBUCxPQUFPLENBQUMsQ0FBRSxDQUFDLFFBQVEsQ0FBQSxBQUFDLENBQUMsRUFBRSxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUE7QUFDM0MsQUFBQSxDQUFDLEdBQUcsQ0FBQSxPQUFPLENBQUEsQUFBQyxPQUFPLENBQUEsQ0FBQSxDQUFBLENBQUE7QUFDbkIsQUFBQSxFQUFFLEtBQUssQ0FBQyxXQUFXLENBQUEsQUFBQyxPQUFPLENBQUMsQ0FBQyxjQUFjLEM7Q0FBQSxDQUFBO0FBQzNDLEFBQUEsQ0FBQyxJQUFJLENBQUEsQ0FBQTtBQUNMLEFBQUEsRUFBRSxHQUFHLENBQUEsQUFBQyxDQUFDLGNBQWMsRUFBRSxPQUFPLENBQUMsVUFBVSxDQUFDLEM7Q0FBQSxDO0FBQUEsQ0FBQTtBQUMxQyxBQUFBO0FBQ0EsQUFBQSx3QkFBdUI7QUFDdkIsQUFBQSxBQUFJLE1BQUosSUFBSSxDQUFDLENBQUUsQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxDQUFDLE1BQU07QUFDbEMsQUFBQSxBQUFJLE1BQUosSUFBSSxDQUFDLENBQUUsQ0FBQyxRQUFRLENBQUEsQUFBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQTtBQUN0RCxBQUFBLEFBQUEsR0FBRyxDQUFBLE9BQU8sQ0FBQSxBQUFDLElBQUksQ0FBQSxDQUFBLENBQUEsQ0FBQTtBQUNmLEFBQUEsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFBLEFBQUMsSUFBSSxDQUFDLENBQUMsY0FBYyxDO0FBQUEsQ0FBQTtBQUN2QyxBQUFBLEFBQUEsSUFBSSxDQUFBLENBQUE7QUFDSixBQUFBLENBQUMsR0FBRyxDQUFBLEFBQUMsQ0FBQyxjQUFjLEVBQUUsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0FBQ25DLEFBQUEsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFBLEFBQUMsRUFBRSxDO0FBQUEsQ0FBQTtBQUNiLEFBQUE7QUFDQSxBQUFBLHdCQUF1QjtBQUN2QixBQUFBLEFBQUEsUUFBUTtBQUNSLEFBQUEsQUFBQSxHQUFHLENBQUEsQ0FBQTtBQUNILEFBQUEsQ0FBTyxNQUFOLE1BQU0sQ0FBQyxDQUFFLENBQUMsT0FBTyxDQUFBLEFBQUMsSUFBSSxDQUFDLENBQUMsS0FBSyxDQUFBO0FBQzlCLEFBQUEsQ0FBQyxNQUFNLENBQUEsQUFBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLGNBQWMsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFBO0FBQ2pELEFBQUEsQ0FBRSxNQUFELENBQUMsQ0FBQyxDQUFFLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQSxBQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQTtBQUN2QyxBQUFBLENBQUMsR0FBRyxDQUFBLE9BQU8sQ0FBQSxBQUFDLENBQUMsQ0FBQyxNQUFNLENBQUEsQ0FBQSxDQUFBLENBQUE7QUFDcEIsQUFBQSxFQUFFLElBQUksQ0FBQSxBQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxRQUFRLEM7Q0FBQSxDQUFBO0FBQ3pCLEFBQUEsQ0FBQyxJQUFJLENBQUEsQ0FBQTtBQUNMLEFBQUEsRUFBRSxHQUFHLENBQUEsQUFBQyxZQUFZLEM7Q0FBQSxDO0FBQUEsQ0FBQTtBQUNsQixBQUFBLEFBQUEsS0FBSyxDQUFDLENBQUEsR0FBRyxDQUFBLENBQUEsQ0FBQTtBQUNULEFBQUEsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFBLEFBQUMsbUJBQW1CLENBQUE7QUFDaEMsQUFBQSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUEsQUFBQyxTQUFTLENBQUMsR0FBRyxDQUMxQixDO0FBQUEiLCJuYW1lcyI6W10sInNvdXJjZXNDb250ZW50IjpbIiMgLS0tIGRlYnVndGVtcC5jbWQuY2l2ZXRcblxuaW1wb3J0IHt3cml0ZWxufSBmcm9tICdjb25zb2xlLXV0aWxzJ1xuaW1wb3J0IHt1bmRlZiwgZGVmaW5lZCwgYXNzZXJ0LCBjcm9ha30gZnJvbSAnZGF0YXR5cGVzJ1xuaW1wb3J0IHtmaW5kRmlsZSwgcGFyc2VQYXRoLCB3aXRoRXh0LCBpc0ZpbGV9IGZyb20gJ2ZzeXMnXG5pbXBvcnQge0RVTVB9IGZyb20gJ3RvLW5pY2UnXG5pbXBvcnQge1xuXHRwcm9jT25lRmlsZSwgcHJvY0ZpbGVzLCBkb0RlYnVnLCBkb0NvbXBpbGVDaXZldCwgZ2V0RXJyU3RyLFxuXHR9IGZyb20gJ2V4ZWMnXG5pbXBvcnQge3NwbGl0QXJyYXksIHNlcCwgc3RkQ2hlY2tzfSBmcm9tICdsbHV0aWxzJ1xuaW1wb3J0IHtmbGFnLCBhcmdWYWx1ZSwgYWxsTm9uT3B0aW9uc30gZnJvbSAnY21kLWFyZ3MnXG5pbXBvcnQge0xPRywgREJHfSBmcm9tICdsb2dnZXInXG5cbnN0ZENoZWNrcyBcIlwiXCJcblx0cnVudGVtcCBbLWRdIFstbmFtZT08dGVtcF9zdHViPiB7IDxsaWJfc3R1Yj4gfVxuXHRcdC0gaWYgbGliICA8bGliX3N0dWI+LmxpYi5jaXZldCAgIGV4aXN0cywgY29tcGlsZSBpdFxuICAgXHQtIGlmIGZpbGUgPHRlbXBfc3R1Yj4udGVtcC5jaXZldCAgZXhpc3RzLCBjb21waWxlIGFuZCBydW4gaXRcbiAgIFx0LSBkZWZhdWx0IDx0ZW1wX3N0dWI+LCBpZiBub25lIHByb3ZpZGVkLCBpcyAndGVtcCdcbiAgIFx0XCJcIlwiXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4jIC0tLSBDb21waWxlIGFueSBsaWJyYXJpZXNcblxuZm9yIGxpYlN0dWIgb2YgYWxsTm9uT3B0aW9ucygpXG5cdGxpYlBhdGggOj0gZmluZEZpbGUgXCIje2xpYlN0dWJ9LmxpYi5jaXZldFwiXG5cdGlmIGRlZmluZWQgbGliUGF0aFxuXHRcdGF3YWl0IHByb2NPbmVGaWxlIGxpYlBhdGgsIGRvQ29tcGlsZUNpdmV0XG5cdGVsc2Vcblx0XHRMT0cgXCJObyBzdWNoIGZpbGU6ICN7bGliU3R1Yn0ubGliLmNpdmV0XCJcblxuIyAtLS0gQ29tcGlsZSB0ZW1wIGZpbGVcbnN0dWIgOj0gYXJnVmFsdWUoJ25hbWUnKSB8fCAndGVtcCdcbnBhdGggOj0gZmluZEZpbGUgXCIje3N0dWJ9LmNpdmV0XCIsIHtyb290OiAnLi9zcmMvdGVtcCd9XG5pZiBkZWZpbmVkIHBhdGhcblx0YXdhaXQgcHJvY09uZUZpbGUgcGF0aCwgZG9Db21waWxlQ2l2ZXRcbmVsc2Vcblx0TE9HIFwiTm8gc3VjaCBmaWxlOiAje3N0dWJ9LmNpdmV0fVwiXG5cdERlbm8uZXhpdCA5OVxuXG4jIC0tLSBSdW4gdGhlIHRlbXAgZmlsZVxuZGVidWdnZXJcbnRyeVxuXHR0c1BhdGggOj0gd2l0aEV4dCBwYXRoLCAnLnRzJ1xuXHRhc3NlcnQgaXNGaWxlKHRzUGF0aCksIFwiTm8gc3VjaCBmaWxlOiAje3RzUGF0aH1cIlxuXHRoIDo9IGF3YWl0IHByb2NPbmVGaWxlIHRzUGF0aCwgZG9EZWJ1Z1xuXHRpZiBkZWZpbmVkIGgub3V0cHV0XG5cdFx0RFVNUCBoLm91dHB1dCwgJ09VVFBVVCdcblx0ZWxzZVxuXHRcdExPRyBcIk5vIG91dHB1dCFcIlxuY2F0Y2ggZXJyXG5cdGNvbnNvbGUubG9nIFwiVEVNUCBGSUxFIEVSUk9SUzpcIlxuXHRjb25zb2xlLmxvZyBnZXRFcnJTdHIoZXJyKSJdfQ==