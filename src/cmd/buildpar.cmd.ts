"use strict";
// buildpar.cmd.civet

import {
	doCompileCivet, doCompileHera,
	doUnitTest, doInstallCmd,
	} from 'exec'
import {assert, defined} from 'datatypes'
import {stdChecks} from 'llutils'
import {flag, nonOption, allNonOptions} from 'cmd-args'
import {withExt, findFile, parsePath, allFilesMatching} from 'fsys'
import {procFiles, procOneFile} from 'exec'

stdChecks(`buildpar (all | <stub>*)`)

// ---------------------------------------------------------------------------
// --- install before running unit tests
//     since unit test may require command to be installed

if (nonOption(0) === 'all') {
	await procFiles(['*.parse.hera', doCompileHera])
	await procFiles(['*.parse.test.civet', doCompileCivet])
	await procFiles(['*.parse.test.ts', doUnitTest])
	await procFiles(['*.parse.ts', doInstallCmd])
}
else {
	for (const stub of allNonOptions()) {
		const heraFileName = `${stub}.parse.hera`
		const heraPath = findFile(heraFileName)
		assert(defined(heraPath), `No such hera file: ${heraFileName}`)
		await procOneFile(heraPath, doCompileHera)

		const testPath = withExt(heraPath, '.test.civet')
		if (findFile(testPath)) {
			await procOneFile(testPath, doCompileCivet)
			await procOneFile(withExt(heraPath, '.test.ts'), doUnitTest)
		}
		else {
			console.log(`No unit test named ${testPath}`)
		}
	}
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQzovVXNlcnMvam9obmQvdXRpbHMvc3JjL2NtZC9idWlsZHBhci5jbWQuY2l2ZXQudHN4Iiwic291cmNlcyI6WyJDOi9Vc2Vycy9qb2huZC91dGlscy9zcmMvY21kL2J1aWxkcGFyLmNtZC5jaXZldCJdLCJtYXBwaW5ncyI6IjtBQUFBLHFCQUFvQjtBQUNwQixBQUFBO0FBQ0EsQUFBQSxNQUFNLENBQUMsQ0FBQztBQUNSLENBQUMsY0FBYyxDQUFDLENBQUMsYUFBYSxDQUFDO0FBQy9CLENBQUMsVUFBVSxDQUFDLENBQUMsWUFBWSxDQUFDO0FBQzFCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNO0FBQ2QsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxXQUFXO0FBQ3pDLEFBQUEsQUFBQSxNQUFNLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUztBQUNqQyxBQUFBLEFBQUEsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLFVBQVU7QUFDdkQsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLENBQUMsSUFBSSxDQUFDLE1BQU07QUFDbkUsQUFBQSxBQUFBLE1BQU0sQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNO0FBQzNDLEFBQUE7QUFDQSxBQUFBLEFBQUEsU0FBUyxDQUFBLEFBQUMsQ0FBRyx3QkFFWixDQUFHLENBQUE7QUFDSixBQUFBO0FBQ0EsQUFBQSw4RUFBNkU7QUFDN0UsQUFBQSx3Q0FBdUM7QUFDdkMsQUFBQSwwREFBeUQ7QUFDekQsQUFBQTtBQUNBLEFBQUEsQUFBQSxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQSxDQUFBO0FBQzFCLEFBQUEsQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFBLEFBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQyxhQUFhLENBQUMsQ0FBQTtBQUNoRCxBQUFBLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQSxBQUFDLENBQUMsb0JBQW9CLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBQTtBQUN2RCxBQUFBLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQSxBQUFDLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQTtBQUNoRCxBQUFBLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQSxBQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsWUFBWSxDQUFDLEM7QUFBQSxDQUFBO0FBQzdDLEFBQUEsQUFBQSxJQUFJLENBQUEsQ0FBQTtBQUNKLEFBQUEsQ0FBQyxHQUFHLENBQUMsQ0FBQSxNQUFBLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBYSxDQUFDLENBQUMsQ0FBQSxDQUFBLENBQUE7QUFDNUIsQUFBQSxFQUFjLE1BQVosWUFBWSxDQUFDLENBQUUsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQztBQUN0QyxBQUFBLEVBQVUsTUFBUixRQUFRLENBQUMsQ0FBRSxDQUFDLFFBQVEsQ0FBQSxBQUFDLFlBQVksQ0FBQTtBQUNuQyxBQUFBLEVBQUUsTUFBTSxDQUFBLEFBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FBQyxtQkFBbUIsRUFBRSxZQUFZLENBQUMsQ0FBQyxDQUFBO0FBQ2hFLEFBQUEsRUFBRSxLQUFLLENBQUMsV0FBVyxDQUFBLEFBQUMsUUFBUSxDQUFDLENBQUMsYUFBYSxDQUFBO0FBQzNDLEFBQUE7QUFDQSxBQUFBLEVBQVUsTUFBUixRQUFRLENBQUMsQ0FBRSxDQUFDLE9BQU8sQ0FBQSxBQUFDLFFBQVEsQ0FBQyxDQUFDLGFBQWEsQ0FBQTtBQUM3QyxBQUFBLEVBQUUsR0FBRyxDQUFBLFFBQVEsQ0FBQSxBQUFDLFFBQVEsQ0FBQSxDQUFBLENBQUEsQ0FBQTtBQUN0QixBQUFBLEdBQUcsS0FBSyxDQUFDLFdBQVcsQ0FBQSxBQUFDLFFBQVEsQ0FBQyxDQUFDLGNBQWMsQ0FBQTtBQUM3QyxBQUFBLEdBQUcsS0FBSyxDQUFDLFdBQVcsQ0FBQSxBQUFDLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLFVBQVUsQztFQUFBLENBQUE7QUFDOUQsQUFBQSxFQUFFLElBQUksQ0FBQSxDQUFBO0FBQ04sQUFBQSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUEsQUFBQyxDQUFDLG1CQUFtQixFQUFFLFFBQVEsQ0FBQyxDQUFDLEM7RUFBQSxDO0NBQUEsQztBQUFBLENBQUE7QUFDL0MiLCJuYW1lcyI6W10sInNvdXJjZXNDb250ZW50IjpbIiMgYnVpbGRwYXIuY21kLmNpdmV0XG5cbmltcG9ydCB7XG5cdGRvQ29tcGlsZUNpdmV0LCBkb0NvbXBpbGVIZXJhLFxuXHRkb1VuaXRUZXN0LCBkb0luc3RhbGxDbWQsXG5cdH0gZnJvbSAnZXhlYydcbmltcG9ydCB7YXNzZXJ0LCBkZWZpbmVkfSBmcm9tICdkYXRhdHlwZXMnXG5pbXBvcnQge3N0ZENoZWNrc30gZnJvbSAnbGx1dGlscydcbmltcG9ydCB7ZmxhZywgbm9uT3B0aW9uLCBhbGxOb25PcHRpb25zfSBmcm9tICdjbWQtYXJncydcbmltcG9ydCB7d2l0aEV4dCwgZmluZEZpbGUsIHBhcnNlUGF0aCwgYWxsRmlsZXNNYXRjaGluZ30gZnJvbSAnZnN5cydcbmltcG9ydCB7cHJvY0ZpbGVzLCBwcm9jT25lRmlsZX0gZnJvbSAnZXhlYydcblxuc3RkQ2hlY2tzIFwiXCJcIlxuXHRidWlsZHBhciAoYWxsIHwgPHN0dWI+Kilcblx0XCJcIlwiXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4jIC0tLSBpbnN0YWxsIGJlZm9yZSBydW5uaW5nIHVuaXQgdGVzdHNcbiMgICAgIHNpbmNlIHVuaXQgdGVzdCBtYXkgcmVxdWlyZSBjb21tYW5kIHRvIGJlIGluc3RhbGxlZFxuXG5pZiAobm9uT3B0aW9uKDApID09ICdhbGwnKVxuXHRhd2FpdCBwcm9jRmlsZXMgWycqLnBhcnNlLmhlcmEnLCBkb0NvbXBpbGVIZXJhXVxuXHRhd2FpdCBwcm9jRmlsZXMgWycqLnBhcnNlLnRlc3QuY2l2ZXQnLCBkb0NvbXBpbGVDaXZldF1cblx0YXdhaXQgcHJvY0ZpbGVzIFsnKi5wYXJzZS50ZXN0LnRzJywgZG9Vbml0VGVzdF1cblx0YXdhaXQgcHJvY0ZpbGVzIFsnKi5wYXJzZS50cycsIGRvSW5zdGFsbENtZF1cbmVsc2Vcblx0Zm9yIHN0dWIgb2YgYWxsTm9uT3B0aW9ucygpXG5cdFx0aGVyYUZpbGVOYW1lIDo9IFwiI3tzdHVifS5wYXJzZS5oZXJhXCJcblx0XHRoZXJhUGF0aCA6PSBmaW5kRmlsZSBoZXJhRmlsZU5hbWVcblx0XHRhc3NlcnQgZGVmaW5lZChoZXJhUGF0aCksIFwiTm8gc3VjaCBoZXJhIGZpbGU6ICN7aGVyYUZpbGVOYW1lfVwiXG5cdFx0YXdhaXQgcHJvY09uZUZpbGUgaGVyYVBhdGgsIGRvQ29tcGlsZUhlcmFcblxuXHRcdHRlc3RQYXRoIDo9IHdpdGhFeHQgaGVyYVBhdGgsICcudGVzdC5jaXZldCdcblx0XHRpZiBmaW5kRmlsZSB0ZXN0UGF0aFxuXHRcdFx0YXdhaXQgcHJvY09uZUZpbGUgdGVzdFBhdGgsIGRvQ29tcGlsZUNpdmV0XG5cdFx0XHRhd2FpdCBwcm9jT25lRmlsZSB3aXRoRXh0KGhlcmFQYXRoLCAnLnRlc3QudHMnKSwgZG9Vbml0VGVzdFxuXHRcdGVsc2Vcblx0XHRcdGNvbnNvbGUubG9nIFwiTm8gdW5pdCB0ZXN0IG5hbWVkICN7dGVzdFBhdGh9XCJcbiJdfQ==