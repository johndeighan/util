"use strict";
// handle.civet

type AutoPromise<T> = Promise<Awaited<T>>;
import {allFilesMatching} from 'fsys'

// ---------------------------------------------------------------------------

export const sleep = async (sec: number): AutoPromise<void> => {

	await new Promise((r) => setTimeout(r, 1000 * sec))
	return
}

// ---------------------------------------------------------------------------

// --- return value is an error message, if any
type TPathHandler = (path: string) => Promise<(string | undefined)>

// --- a hash with key path and result string, if error, else undef
type THandlerResult = {[path: string]: (string | undefined)}

const handleFiles = async (
		pattern: string,
		func: TPathHandler
		): AutoPromise<THandlerResult> => {

	const results=[];for (const path of allFilesMatching(pattern)) {
		results.push(path)
	};const lPaths =results
	const results1=[];for (const path of lPaths) {
		results1.push(func(path))
	};const lPromises =results1
	const lResults = await Promise.all(lPromises)
	const hResults: THandlerResult = {}
	let i1 = 0;for (const path of lPaths) {const i = i1++;
		hResults[path] = lResults[i]
	}
	return hResults
}

const logPath = async (path: string):AutoPromise<(string | undefined)> => {

	await sleep(1)
	console.log(path)
	return (path === 'abc') ? `FILE: ${path}` : undefined
}

const hResults = await handleFiles("**/*.test.civet", logPath)
console.dir(hResults)


//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3JjXFx0ZXN0XFxoYW5kbGUuY2l2ZXQudHN4Iiwic291cmNlcyI6WyJzcmNcXHRlc3RcXGhhbmRsZS5jaXZldCJdLCJtYXBwaW5ncyI6IjtBQUFBLGVBQWM7QUFDZCxBQUFBO0FBQ0EsSyxXLHlCO0FBQUEsTUFBTSxDQUFDLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTTtBQUNyQyxBQUFBO0FBQ0EsQUFBQSw4RUFBNkU7QUFDN0UsQUFBQTtBQUNBLEFBQUEsQUFBQSxNQUFNLENBQU0sTUFBTCxLQUFLLENBQUMsQ0FBRSxDLE1BQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLENBQUMsQyxDLFcsQ0FBQyxBQUFDLEksQ0FBSSxDQUFDLEVBQUUsQ0FBQSxDQUFBO0FBQ3RDLEFBQUE7QUFDQSxBQUFBLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7QUFDcEQsQUFBQSxDQUFDLE07QUFBTSxDQUFBO0FBQ1AsQUFBQTtBQUNBLEFBQUEsOEVBQTZFO0FBQzdFLEFBQUE7QUFDQSxBQUFBLCtDQUE4QztBQUM5QyxBQUFBLEFBQUEsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsT0FBTyxDLENBQUMsTSxZLENBQU8sQ0FBQztBQUN0RCxBQUFBO0FBQ0EsQUFBQSxtRUFBa0U7QUFDbEUsQUFBQSxBQUFBLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsQyxDLENBQUMsQUFBQyxNLFksQ0FBTyxDQUFDO0FBQy9DLEFBQUE7QUFDQSxBQUFBLEFBQVcsTUFBWCxXQUFXLENBQUMsQ0FBRSxDLE1BQUMsQ0FBQztBQUNoQixBQUFBLEVBQUUsT0FBTyxDQUFDLENBQUMsTUFBTSxDQUFBO0FBQ2pCLEFBQUEsRUFBRSxJQUFJLENBQUMsQ0FBQyxZQUFZO0FBQ3BCLEVBQUUsQ0FBQyxDLEMsVyxDQUFDLEFBQUMsYyxDQUFjLENBQUMsRUFBRSxDQUFBLENBQUE7QUFDdEIsQUFBQTtBQUNBLEFBQUEsQyxLLEMsTyxHLENBQVcsR0FBRyxDQUFDLENBQUEsTUFBQSxJQUFJLENBQUMsRUFBRSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxDQUFBLENBQUEsQ0FBQTtBQUNoRCxBQUFBLEUsTyxNQUFFLEksQztDQUFJLEMsQ0FEQyxNQUFOLE1BQU0sQ0FBQyxDLE9BQ0Y7QUFDTixBQUFBLEMsSyxDLFEsRyxDQUFjLEdBQUcsQ0FBQyxDQUFBLE1BQUEsSUFBSSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUEsQ0FBQSxDQUFBO0FBQ2hDLEFBQUEsRSxRLE1BQUUsSUFBSSxDQUFDLElBQUksQyxDO0NBQUMsQyxDQURGLE1BQVQsU0FBUyxDQUFDLEMsUUFDQztBQUNaLEFBQUEsQ0FBUyxNQUFSLFFBQVEsQ0FBQyxDQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUEsQUFBQyxTQUFTLENBQUE7QUFDeEMsQUFBQSxDQUF5QixNQUF4QixRQUFRLENBQUMsQ0FBQyxjQUFjLENBQUMsQ0FBRSxDQUFDLENBQUMsQ0FBQztBQUMvQixBQUFBLEMsSSxFLEksQ0FBQyxHQUFHLENBQUMsQ0FBQSxNQUFBLElBQU0sQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFBLENBQUEsQ0FBWCxNQUFBLEMsRyxFLEUsQ0FBVztBQUNyQixBQUFBLEVBQUUsUUFBUSxDQUFDLElBQUksQ0FBQyxDLENBQUUsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDO0NBQUMsQ0FBQTtBQUM5QixBQUFBLENBQUMsTUFBTSxDQUFDLFE7QUFBUSxDQUFBO0FBQ2hCLEFBQUE7QUFDQSxBQUFBLEFBQU8sTUFBUCxPQUFPLENBQUMsQ0FBRSxDLE1BQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsQyxXLEMsQ0FBQyxBQUFDLE0sWSxDLENBQU8sQ0FBQyxFQUFFLENBQUEsQ0FBQTtBQUNyQyxBQUFBO0FBQ0EsQUFBQSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUEsQUFBQyxDQUFDLENBQUE7QUFDZCxBQUFBLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQSxBQUFDLElBQUksQ0FBQTtBQUNqQixBQUFBLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUUsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsUztBQUFTLENBQUE7QUFDckQsQUFBQTtBQUNBLEFBQUEsQUFBUSxNQUFSLFFBQVEsQ0FBQyxDQUFFLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQSxBQUFDLGlCQUFpQixDQUFDLENBQUMsT0FBTyxDQUFBO0FBQ3hELEFBQUEsQUFBQSxPQUFPLENBQUMsR0FBRyxDQUFBLEFBQUMsUUFBUSxDQUFBO0FBQ3BCO0FBQ0EiLCJuYW1lcyI6W10sInNvdXJjZXNDb250ZW50IjpbIiMgaGFuZGxlLmNpdmV0XG5cbmltcG9ydCB7YWxsRmlsZXNNYXRjaGluZ30gZnJvbSAnZnN5cydcblxuIyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuZXhwb3J0IHNsZWVwIDo9IChzZWM6IG51bWJlcik6IHZvaWQgPT5cblxuXHRhd2FpdCBuZXcgUHJvbWlzZSgocikgPT4gc2V0VGltZW91dChyLCAxMDAwICogc2VjKSlcblx0cmV0dXJuXG5cbiMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbiMgLS0tIHJldHVybiB2YWx1ZSBpcyBhbiBlcnJvciBtZXNzYWdlLCBpZiBhbnlcbnR5cGUgVFBhdGhIYW5kbGVyID0gKHBhdGg6IHN0cmluZykgPT4gUHJvbWlzZTxzdHJpbmc/PlxuXG4jIC0tLSBhIGhhc2ggd2l0aCBrZXkgcGF0aCBhbmQgcmVzdWx0IHN0cmluZywgaWYgZXJyb3IsIGVsc2UgdW5kZWZcbnR5cGUgVEhhbmRsZXJSZXN1bHQgPSB7W3BhdGg6IHN0cmluZ106IHN0cmluZz99XG5cbmhhbmRsZUZpbGVzIDo9IChcblx0XHRwYXR0ZXJuOiBzdHJpbmdcblx0XHRmdW5jOiBUUGF0aEhhbmRsZXJcblx0XHQpOiBUSGFuZGxlclJlc3VsdCA9PlxuXG5cdGxQYXRocyA6PSBmb3IgcGF0aCBvZiBhbGxGaWxlc01hdGNoaW5nKHBhdHRlcm4pXG5cdFx0cGF0aFxuXHRsUHJvbWlzZXMgOj0gZm9yIHBhdGggb2YgbFBhdGhzXG5cdFx0ZnVuYyhwYXRoKVxuXHRsUmVzdWx0cyA6PSBhd2FpdCBQcm9taXNlLmFsbCBsUHJvbWlzZXNcblx0aFJlc3VsdHM6IFRIYW5kbGVyUmVzdWx0IDo9IHt9XG5cdGZvciBwYXRoLGkgb2YgbFBhdGhzXG5cdFx0aFJlc3VsdHNbcGF0aF0gPSBsUmVzdWx0c1tpXVxuXHRyZXR1cm4gaFJlc3VsdHNcblxubG9nUGF0aCA6PSAocGF0aDogc3RyaW5nKTogc3RyaW5nPyA9PlxuXG5cdGF3YWl0IHNsZWVwIDFcblx0Y29uc29sZS5sb2cgcGF0aFxuXHRyZXR1cm4gKHBhdGggPT0gJ2FiYycpID8gXCJGSUxFOiAje3BhdGh9XCIgOiB1bmRlZmluZWRcblxuaFJlc3VsdHMgOj0gYXdhaXQgaGFuZGxlRmlsZXMgXCIqKi8qLnRlc3QuY2l2ZXRcIiwgbG9nUGF0aFxuY29uc29sZS5kaXIgaFJlc3VsdHNcblxuIl19