# temp.test.civet

import {undef} from 'datatypes'
import {
	TSyncMapper, TAsyncMapper, TIterator, TAsyncIterator, TMaybeCmd,
	syncMapper, syncReducer, mapper, reducer,
	} from 'var-free'
import {equal, generateAsync} from 'unit-test'

# ---------------------------------------------------------------------------
# --- test reducer() with plain function

await (() =>
	# --- reducing (getting the sum)

	sum := await reducer generateAsync([1..4]), 0, (acc, n) =>
		return acc + n

	equal sum, 10
	)()

await (() =>
	# --- reducing (getting the sum)

	sum := await reducer [1..4], 0, (acc, n) =>
		return acc + n

	equal sum, 10
	)()

await (() =>
	# --- reducing (getting the sum, early abort)

	sum := await reducer generateAsync([1..4]), 0, (acc, n) =>
		return (n < 3) ? acc + n : undef

	equal sum, 3
	)()

await (() =>
	# --- reducing (getting the sum, early abort)

	sum := await reducer [1..4], 0, (acc, n) =>
		return (n < 3) ? acc + n : undef

	equal sum, 3
	)()

await (() =>
	# --- reducing (getting the sum AND sum of squares)

	type TAcc = [number, number]

	[sum, sumsq] := await reducer generateAsync([1..4]), [0, 0], (acc, n) =>
		[sum, sumsq] := acc
		return [sum + n, sumsq + n*n]

	equal sum, 10
	equal sumsq, 30
	)()

await (() =>
	# --- reducing (getting the sum AND sum of squares)

	type TAcc = [number, number]

	[sum, sumsq] := await reducer [1..4], [0, 0], (acc, n) =>
		[sum, sumsq] := acc
		return [sum + n, sumsq + n*n]

	equal sum, 10
	equal sumsq, 30
	)()

await (() =>
	# --- reducing
	#     (getting the sum AND sum of squares of only even nums)

	type TAcc = [number, number]

	[sum, sumsq] := await reducer generateAsync([1..4]), [0, 0], (acc, n) =>
		[sum, sumsq] := acc
		return (n % 2 == 0) ? [sum + n, sumsq + n*n] : acc

	equal sum, 6
	equal sumsq, 20
	)()

await (() =>
	# --- reducing
	#     (getting the sum AND sum of squares of only even nums)

	type TAcc = [number, number]

	[sum, sumsq] := await reducer [1..4], [0, 0], (acc, n) =>
		[sum, sumsq] := acc
		return (n % 2 == 0) ? [sum + n, sumsq + n*n] : acc

	equal sum, 6
	equal sumsq, 20
	)()

